---
layout: post
title: å¦‚ä½•ä»æ‰‹æœºåª’ä½“åº“ä¸­è·å–å…¨éƒ¨è§†é¢‘æ–‡ä»¶
categories: [Android]
description: å¦‚ä½•ä»æ‰‹æœºåª’ä½“åº“ä¸­è·å–å…¨éƒ¨è§†é¢‘æ–‡ä»¶
keywords: mediastore, åª’ä½“åº“, è§†é¢‘æ–‡ä»¶
---


## å¦‚ä½•ä»æ‰‹æœºåª’ä½“åº“ä¸­è·å–å…¨éƒ¨è§†é¢‘æ–‡ä»¶

æœ€è¿‘é¡¹ç›®åœ¨åšä¸€ä¸ªè§†é¢‘é€‰æ‹©çš„åŠŸèƒ½ï¼Œä¸€å¼€å§‹çš„æ€è·¯æ˜¯é€šè¿‡ MediaStoreè·å–åª’ä½“ä¿¡æ¯ï¼š

``` Java
  public static List<LocalVideoBean> getLocalVideoList(Context context) {
    List<LocalVideoBean> localVideoBeans = new ArrayList<>();
    // MediaStore.Video.Thumbnails.DATA:è§†é¢‘ç¼©ç•¥å›¾çš„æ–‡ä»¶è·¯å¾„
    String[] thumbColumns = {MediaStore.Video.Thumbnails.DATA,
            MediaStore.Video.Thumbnails.VIDEO_ID};
    // è§†é¢‘å…¶ä»–ä¿¡æ¯çš„æŸ¥è¯¢æ¡ä»¶
    String[] mediaColumns = {MediaStore.Video.Media._ID,
            MediaStore.Video.Media.DATA, MediaStore.Video.Media.DURATION, MediaStore.Video.Media.SIZE};

    Cursor cursor = context.getContentResolver().query(MediaStore.Video.Media
                    .EXTERNAL_CONTENT_URI,
            mediaColumns, null, null, null);

    if (cursor == null) {
      return localVideoBeans;
    }

    try {
      if (cursor.moveToFirst()) {
        do {
          LocalVideoBean info = new LocalVideoBean();
          int id = cursor.getInt(cursor
                  .getColumnIndex(MediaStore.Video.Media._ID));
          Cursor thumbCursor = context.getContentResolver().query(
                  MediaStore.Video.Thumbnails.EXTERNAL_CONTENT_URI,
                  thumbColumns, MediaStore.Video.Thumbnails.VIDEO_ID
                          + "=" + id, null, null);
          if (thumbCursor == null) {
            continue;
          }
          try {
            if (thumbCursor.moveToFirst()) {
              info.setId(id);
              info.setVideoPath(cursor.getString(cursor.getColumnIndexOrThrow(MediaStore.Video.Media
                      .DATA)));
              ......
              localVideoBeans.add(info);
            }
          } catch (Exception e) {
            LogUtil.e(TAG, e.toString());
          } finally {
            if (!thumbCursor.isClosed()) {
              thumbCursor.close();
            }
          }
        } while (cursor.moveToNext());
      }
    } catch (Exception e) {
      LogUtil.e(TAG, e.toString());
    } finally {
      if (!cursor.isClosed()) {
        cursor.close();
      }
    }
    return localVideoBeans;
  }
```

å¯æ˜¯å‘ç°åœ¨ä¸€åŠ æ‰‹æœº5å’Œä¸‰æ˜Ÿçš„éƒ¨åˆ†æœºå‹ä¸Šå¹¶ä¸èƒ½å°†**æœ€è¿‘**æ‹çš„æ–°è§†é¢‘è·å–åˆ°ã€‚ç½‘ç»œä¸Šä¹Ÿå¤§å¤šæ˜¯ç›¸äº’æŠ„å·®ä¸å¤šçš„ä»£ç ã€‚

åæ¥çµæœºä¸€åŠ¨ï¼Œæ—¢ç„¶æ‰‹æœºä¸Šçš„å›¾åº“è½¯ä»¶éƒ½èƒ½å°†æœ€è¿‘æ‹æ‘„çš„è§†é¢‘åŠ è½½å‡ºæ¥ï¼Œé‚£ä¹ˆè‚¯å®šå­˜åœ¨å®ç°æ–¹å¼ï¼Œèƒ½å°†æœ€æ–°çš„è§†é¢‘åŠ è½½å‡ºæ¥ã€‚

åæ¥æ‰¾åˆ°ä¸€ä¸ªå›¾åº“å®ç°åº“ï¼Œçœ‹äº†ä¸‹æºç ï¼Œå…¶å®å’Œä¸Šé¢çš„ä»£ç å¹¶æ²¡æœ‰å¤šå°‘å·®åˆ«ï¼š

``` Java
  /**
   * è·å–æœ¬åœ°è§†é¢‘
   *
   * @param context
   * @return æœ¬åœ°è§†é¢‘åˆ—è¡¨
   */
  public static List<LocalVideoBean> getLocalVideoList(Context context) {
    List<LocalVideoBean> localVideoBeans = new ArrayList<>();
    ContentResolver contentResolver = context.getContentResolver();
    String[] projection = new String[]{
            MediaStore.Video.Media._ID,
            MediaStore.Video.Media.DATA,
            MediaStore.Video.Media.DURATION,
            MediaStore.Video.Media.SIZE
    };

    Cursor cursor = contentResolver.query(
            MediaStore.Video.Media.EXTERNAL_CONTENT_URI,
            projection,
            null,
            null,
            MediaStore.Video.Media.DATE_ADDED + " DESC LIMIT " + Integer.MAX_VALUE + " OFFSET " + 0);

    if (cursor != null) {
      try {
        int count = cursor.getCount();
        if (count > 0) {
          cursor.moveToFirst();
          do {
            LocalVideoBean localVideoBean = parseVideoCursor(context, cursor);
            if (localVideoBean != null) {
              localVideoBeans.add(localVideoBean);
            }
          } while (cursor.moveToNext());
        }
      } catch (Exception e) {
        LogUtil.e(TAG, e);
      } finally {
        if (!cursor.isClosed()) {
          cursor.close();
        }
      }
    }
    return localVideoBeans;
  }
```


å’Œç¬¬ä¸€æ®µä»£ç å¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒä¹‹å¤„ï¼Œé™¤äº†ä¸€å¤„...


Cursor cursor = contentResolver.query(
        MediaStore.Video.Media.EXTERNAL_CONTENT_URI,
        projection,
        null,
        null,
        **MediaStore.Video.Media.DATE_ADDED + " DESC LIMIT " + Integer.MAX_VALUE + " OFFSET " + 0**);

ä¸ºä»€ä¹ˆå˜ä¸ºè¿™ä¸ªæ’åºæ¡ä»¶å°±å¯ä»¥å°†æœ€è¿‘æ‹æ‘„çš„è§†é¢‘å–å‡ºå‘¢ï¼Ÿè¿™éœ€è¦çœ‹çœ‹æºç æ˜¯æ€ä¹ˆå®ç°çš„ï¼Œé˜…è¯»æºç ä¸­...




å¦‚æœ‰ç¼ºæ¼ä¸è¶³ä¹‹å¤„ï¼Œæ¬¢è¿åˆ›å»ºissueï¼ŒPR ğŸ˜„

